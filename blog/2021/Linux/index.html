<!DOCTYPE html> <html lang="cn"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Linux 相关指令 | Linchang Xiao</title> <meta name="author" content="Linchang Xiao"> <meta name="description" content="Linux 相关指令"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/icon.jpg?7b7b29ac9f6063e03543e5148578c7f5"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://xlcbingo1999.github.io/blog/2021/Linux/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?6185d15ea1982787ad7f435576553d64"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Linchang </span>Xiao</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Linux 相关指令</h1> <p class="post-meta">October 10, 2021</p> <p class="post-tags"> <a href="/blog/2021"> <i class="fa-solid fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%AE%B0"> <i class="fa-solid fa-hashtag fa-sm"></i> 技术杂记</a>     ·   <a href="/blog/category/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%AE%B0"> <i class="fa-solid fa-tag fa-sm"></i> 技术杂记</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="linux-原生">Linux 原生</h2> <h3 id="性能检查工具">性能检查工具</h3> <ul> <li> <p>最常用的几个命令：</p> <ul> <li>参考文献：<a href="https://www.jianshu.com/p/3422ea8ad008" rel="external nofollow noopener" target="_blank">https://www.jianshu.com/p/3422ea8ad008</a> </li> <li>Top</li> <li>Htop： 检查进程和内存占用</li> </ul> </li> <li> <p>检查进程</p> <ul> <li>参考文献：<a href="https://cloud.tencent.com/developer/article/1711858" rel="external nofollow noopener" target="_blank">https://cloud.tencent.com/developer/article/1711858</a> </li> </ul> </li> </ul> <h3 id="开机自启动指令">开机自启动指令</h3> <ul> <li><a href="https://blog.csdn.net/tuzixini/article/details/95616333" rel="external nofollow noopener" target="_blank">Ubuntu/Linux 开机运行指定的命令/自动运行命令_tuzixini 的博客-CSDN 博客_ubuntu 开机自动运行命令</a></li> </ul> <h3 id="关闭开启自动更新">关闭/开启自动更新</h3> <ul> <li><a href="https://blog.csdn.net/davidhzq/article/details/102651588" rel="external nofollow noopener" target="_blank">怎么禁止/开启 Ubuntu 自动更新升级_豆豆技术派的博客-CSDN 博客</a></li> </ul> <h3 id="服务器文件夹共享远程文件夹">服务器文件夹共享/远程文件夹</h3> <ul> <li>参考文献：<a href="https://blog.csdn.net/b876144622/article/details/79871132" rel="external nofollow noopener" target="_blank">两台 ubuntu 服务器文件共享_keep_forward 的博客-CSDN 博客_2 台 ubuntu 映射共享文件夹</a> </li> </ul> <div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="nt">挂载</span>
<span class="nt">sudo</span> <span class="nt">mount</span> <span class="nt">-t</span> <span class="nt">nfs</span>  <span class="err">10</span><span class="nc">.xxx.xxx.xxx</span><span class="o">:/</span><span class="nt">path-to-share</span> <span class="o">/</span><span class="nt">path-to-mount</span>
<span class="err">#</span> <span class="nt">取消挂载</span>
<span class="nt">sudo</span> <span class="nt">unmount</span><span class="nc">.nfs</span> <span class="o">/</span><span class="nt">path-to-mount</span>
</code></pre></div></div> <ul> <li>本机：文件链接</li> </ul> <h3 id="tee-命令">tee 命令</h3> <ul> <li>作用：从标准输入中复制到每一个文件，并输出到标准输出。</li> <li>参考文献：<a href="https://zhuanlan.zhihu.com/p/34510815" rel="external nofollow noopener" target="_blank">为初学者介绍的 Linux tee 命令（6 个例子） - 知乎 (zhihu.com)</a> </li> </ul> <h3 id="磁盘容量分配扩容">磁盘容量分配扩容</h3> <ul> <li>直接根据参考文献的方法修改即可获得满容量的 Ubuntu</li> <li>指令：</li> </ul> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo lvextend -L +100G /dev/mapper/ubuntu--vg-ubuntu--lv
sudo resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv
</code></pre></div></div> <h3 id="全局搜索文件或文件夹">全局搜索文件或文件夹</h3> <ul> <li>参考文献：<a href="https://blog.csdn.net/dcrmg/article/details/78000961" rel="external nofollow noopener" target="_blank">在 ubuntu 中搜索文件或文件夹的方法_ubuntu find 文件夹_-牧野-的博客-CSDN 博客</a> </li> <li> <strong>whereis+ 文件名</strong>： 用于程序名的搜索，搜索结果只限于二进制文件（参数-b）、man 说明文件（参数-m）和源代码文件（参数-s），如果省略参数，则返回所有信息。</li> <li> <strong>find / -name + 文件名</strong>： find 是在指定的目录下遍历查找，如果目录使用 / 则表示在所有目录下查找，find 方式查找文件消耗资源比较大，速度也慢一点。</li> <li> <strong>locate+ 文件名</strong>： linux 会把系统内所有的文件都记录在一个数据库文件中，使用 locate+ 文件名的方法会在 linux 系统维护的这个数据库中去查找目标，相比 find 命令去遍历磁盘查找的方式，效率会高很多，比较推荐使用这种方法。但有一个问题是数据库文件不是实时更新的，一般会每周更新一次，所以使用 locate 命令查找到的结果不一定是准确的。当然可以在使用 locate 之前通过 updatedb 命令更新一次数据库，保证结果的性。</li> <li> <strong>which+ 可执行文件名：</strong>which 的作用是在 PATH 变量指定的路径中，搜索某个系统命令的位置，并且返回第一个搜索结果。使用 which 命令，就可以看到某个系统命令是否存在，以及执行的到底是哪一个位置的命令。which 指令会在环境变量 $PATH 设置的目录里查找符合条件的文件，所以基本的功能是寻找可执行文件。</li> </ul> <p>###</p> <p>###</p> <h3 id="wait-指令">wait 指令</h3> <ul> <li>wait [作业指示或进程号] <ul> <li>1.等待作业号或者进程号制定的进程退出，返回最后一个作业或进程的退出状态状态。如果没有制定参数，则等待所有子进程的退出，其退出状态为 0.</li> <li>2.如果是 shell 中等待使用 wait，则不会等待调用函数中子任务。在函数中使用 wait，则只等待函数中启动的后台子任务。</li> <li>3.在 shell 中使用 wait 命令，相当于高级语言里的多线程同步。</li> </ul> </li> </ul> <h3 id="grep-和-awk-指令用于提取-csv-中的行">grep 和 awk 指令用于提取 csv 中的行</h3> <ul> <li> <p>这段 Shell 脚本的主要作用是循环处理一组客户端（<code class="language-plaintext highlighter-rouge">max_clients</code> 个客户端），对于每个客户端，它执行以下操作：</p> <ul> <li>使用 <code class="language-plaintext highlighter-rouge">grep</code> 命令查找匹配客户端 ID 的行，这些行位于 <code class="language-plaintext highlighter-rouge">${log_path}/frame_path.csv</code> 文件中。<code class="language-plaintext highlighter-rouge">^${client_id}</code> 表示以客户端 ID 开头的行。</li> <li> <code class="language-plaintext highlighter-rouge">grep "^${client_id}" ${log_path}/frame_path.csv</code> 用于在文件中查找匹配的行。</li> <li> <code class="language-plaintext highlighter-rouge">&gt; /dev/null 2&gt;&amp;1</code> 表示将标准输出和标准错误重定向到 <code class="language-plaintext highlighter-rouge">/dev/null</code>，即将匹配结果的输出静默化，只关心命令的返回状态码。</li> </ul> </li> <li> <p>检查 <code class="language-plaintext highlighter-rouge">grep</code> 命令的返回状态码，如果状态码为 0，表示找到了匹配的行，即客户端 ID 存在于文件中。</p> <ul> <li>如果客户端 ID 存在于文件中（即状态码为 0），则使用 <code class="language-plaintext highlighter-rouge">awk</code> 命令从 <code class="language-plaintext highlighter-rouge">${log_path}/frame_path.csv</code> 文件中提取符合条件的行，并将结果保存到 <code class="language-plaintext highlighter-rouge">${log_path}/frame_stats_${client_id}.csv</code> 文件中。</li> <li> <code class="language-plaintext highlighter-rouge">awk "NR==1 || /^${client_id}/" ${log_path}/frame_path.csv</code> 用于提取匹配条件的行。条件是：行号为 1（即文件的第一行）或以客户端 ID 开头的行。</li> <li>提取的结果将被保存到以客户端 ID 命名的 CSV 文件中，文件名格式为 <code class="language-plaintext highlighter-rouge">frame_stats_${client_id}.csv</code>。</li> </ul> </li> </ul> <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">grep</span> <span class="s">"^</span>$<span class="p">{</span><span class="kn">client_id</span><span class="err">}</span><span class="s">"</span> $<span class="p">{</span><span class="kn">log_path</span><span class="err">}</span><span class="n">/frame_path.csv</span> <span class="s">&gt;</span> <span class="n">/dev/null</span> <span class="mi">2</span><span class="s">&gt;&amp;1</span>
<span class="s">if</span> <span class="s">[</span> $<span class="s">?</span> <span class="s">-eq</span> <span class="mi">0</span> <span class="s">]</span><span class="p">;</span> <span class="kn">then</span>
  <span class="s">awk</span> <span class="s">"NR==1</span> <span class="s">||</span> <span class="n">/^</span>$<span class="p">{</span><span class="kn">client_id</span><span class="err">}</span><span class="n">/"</span> $<span class="p">{</span><span class="kn">log_path</span><span class="err">}</span><span class="n">/frame_path.csv</span> <span class="s">&gt;</span> $<span class="p">{</span><span class="kn">log_path</span><span class="err">}</span><span class="n">/frame_stats_</span>$<span class="p">{</span><span class="kn">client_id</span><span class="err">}</span><span class="s">.csv</span>
</code></pre></div></div> <h3 id="动态链接库和可执行文件">动态链接库和可执行文件</h3> <ul> <li>查看当前系统中动态链接库的信息【在哪里】</li> </ul> <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ldconfig</span> <span class="s">-p</span> <span class="s">|</span> <span class="s">grep</span> <span class="s">tinfo</span>
</code></pre></div></div> <ul> <li>查看动态链接库和可执行文件的依赖动态库</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ldd</span> <span class="p">.</span><span class="o">/</span><span class="n">node</span>
<span class="n">ldd</span> <span class="p">.</span><span class="o">/</span><span class="n">libreadline</span><span class="p">.</span><span class="n">so</span><span class="p">.</span><span class="mi">8</span>
</code></pre></div></div> <ul> <li>利用 patchelf 修改某些链接</li> </ul> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 针对动态库</span>
<span class="n">patchelf</span> <span class="p">\</span>
    <span class="o">--</span><span class="n">set</span><span class="o">-</span><span class="n">rpath</span> <span class="sr">/usr/s</span><span class="n">w</span><span class="o">-</span><span class="n">cluster</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.17</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="ss">:/</span><span class="n">usr</span><span class="o">/</span><span class="n">sw</span><span class="o">-</span><span class="n">cluster</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="no">Anaconda</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span> <span class="p">\</span>
    <span class="p">.</span><span class="nf">/</span><span class="n">libreadline</span><span class="p">.</span><span class="nf">so</span><span class="o">.</span><span class="mi">8</span>
    
<span class="c1"># 针对可执行文件</span>
<span class="n">patchelf</span> <span class="p">\</span>
    <span class="o">--</span><span class="n">set</span><span class="o">-</span><span class="n">rpath</span> <span class="sr">/usr/s</span><span class="n">w</span><span class="o">-</span><span class="n">cluster</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.17</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="ss">:/</span><span class="n">usr</span><span class="o">/</span><span class="n">sw</span><span class="o">-</span><span class="n">cluster</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="no">Anaconda</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span> <span class="p">\</span>
    <span class="o">--</span><span class="n">set</span><span class="o">-</span><span class="n">interpreter</span> <span class="sr">/usr/s</span><span class="n">w</span><span class="o">-</span><span class="n">cluster</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.17</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">ld</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x86</span><span class="o">-</span><span class="mi">64</span><span class="p">.</span><span class="nf">so</span><span class="o">.</span><span class="mi">2</span> <span class="p">\</span>
    <span class="p">.</span><span class="nf">/</span><span class="n">libreadline</span><span class="p">.</span><span class="nf">so</span><span class="o">.</span><span class="mi">8</span>
    
<span class="c1"># 针对之前已经存在链接的相关库</span>
<span class="n">patchelf</span> <span class="o">--</span><span class="n">replace</span><span class="o">-</span><span class="n">needed</span> <span class="n">libm</span><span class="p">.</span><span class="nf">so</span><span class="o">.</span><span class="mi">6</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sw</span><span class="o">-</span><span class="n">cluster</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.17</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libm</span><span class="p">.</span><span class="nf">so</span><span class="o">.</span><span class="mi">6</span> <span class="p">.</span><span class="nf">/</span><span class="n">ninja</span>

<span class="n">patchelf</span> <span class="o">--</span><span class="n">replace</span><span class="o">-</span><span class="n">needed</span> <span class="n">libc</span><span class="p">.</span><span class="nf">so</span><span class="o">.</span><span class="mi">6</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sw</span><span class="o">-</span><span class="n">cluster</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">glibc</span><span class="o">-</span><span class="mf">2.17</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="nf">so</span><span class="o">.</span><span class="mi">6</span> <span class="p">.</span><span class="nf">/</span><span class="n">ninja</span>
</code></pre></div></div> <ul> <li>在神威上的 patchelf：/usr/sw-cluster/apps/Anaconda/anaconda3/bin/patchelf</li> </ul> <h3 id="软链接">软链接</h3> <ul> <li>linux 软链接</li> </ul> <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ln</span> <span class="s">-s</span> <span class="s">源文件</span> <span class="s">目标文件</span>
</code></pre></div></div> <h3 id="查看系统的硬件信息">查看系统的硬件信息</h3> <h4 id="体系架构">体系架构</h4> <ul> <li>x86</li> </ul> <h4 id="cpu-区分是金牌还是银牌">CPU 区分是金牌还是银牌</h4> <ul> <li>CPU 比较网站：<a href="https://versus.com/cn/intel-xeon-e5-2660-vs-intel-xeon-silver-4110" rel="external nofollow noopener" target="_blank">Intel Xeon E5-2660 vs Intel Xeon Silver 4110：有何不同？ (versus.com)</a> </li> <li> <p>CPU 系列对应</p> <ul> <li>E5 对位铜牌和银牌，以及 5000 系金牌</li> <li>E7 对位 6000 系金牌和铂金牌</li> <li>E3 对位 E-21xx/22xx</li> </ul> </li> </ul> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/feishu_docs_static/Z11Kbrc1QoI1k4xcsmlc09oMnwe-480.webp 480w, /assets/img/feishu_docs_static/Z11Kbrc1QoI1k4xcsmlc09oMnwe-800.webp 800w, /assets/img/feishu_docs_static/Z11Kbrc1QoI1k4xcsmlc09oMnwe-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/feishu_docs_static/Z11Kbrc1QoI1k4xcsmlc09oMnwe.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <h4 id="电口光口">电口/光口</h4> <ul> <li>光口 <ul> <li>光口是服务器和网络中对各种光纤端口的统称，它是以光作为信息的承载介质。光口可能包含有从 ST 到 SFF（小型化光纤连接器，以 MTRJ 和 LC 为主）的各种光纤接口，因此在布线施工后期配备光纤跳线时，需要核实光口的光纤接口种类，以免在布线配置时假定的光纤跳线种类与实际使用的 要求不匹配。</li> <li>光纤接口是用来连接光纤线缆的物理接口。其原理是利用了光从光密介质进入光疏介质从而发生了全反射。通常有 SC、ST、FC 等几种类型，它们由日本 NTT 公司开发。FC 是 Ferrule Connector 的缩写，其外部加强方式是采用金属套，紧固方式为螺丝扣。ST 接口通常用于 10Base-F，SC 接口通常用于 100Base-FX。</li> <li>查看光口数量的指令: <code class="language-plaintext highlighter-rouge">lspci | grep Network</code> </li> <li>宝德没有光卡</li> </ul> </li> </ul> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/feishu_docs_static/UVO1b29Dyo6PjsxuTT7c1fEBnTK-480.webp 480w, /assets/img/feishu_docs_static/UVO1b29Dyo6PjsxuTT7c1fEBnTK-800.webp 800w, /assets/img/feishu_docs_static/UVO1b29Dyo6PjsxuTT7c1fEBnTK-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/feishu_docs_static/UVO1b29Dyo6PjsxuTT7c1fEBnTK.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <ul> <li>电口 <ul> <li>电口是服务器和网络中对 RJ45 等各种双绞线接口的统称，其原因是这些端口都使用电作为信息的承载介 质，不过有时它也会包含同轴电缆端口。通常电口可能使用百兆以太网、千兆以太网、万兆以太网或其它种类的传输协议。</li> <li>电口是相对光口来讲的，是指防火器的物理特性，主要指铜缆，包括普通的网线和射频同轴电缆，是处理的电信号。目前使用普遍的网络接口有百兆电口和千兆电口等。简单来说，电口就是普通的双绞线（Twirst Pair）接口，一般速率为 10M 或者 100M，部分支持 1000M.电口的最远距离为 100 米。光口的线缆上传输的是光信号，而电口的线缆上传输的是电信号，例如高电平（代表 1），低电平（代表 0）。</li> <li>查看电口数量的指令：<code class="language-plaintext highlighter-rouge">lspci -vvv|grep Ether</code> </li> </ul> </li> </ul> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/feishu_docs_static/Qwbbb03SeowH97xjIjXc8IcPnye-480.webp 480w, /assets/img/feishu_docs_static/Qwbbb03SeowH97xjIjXc8IcPnye-800.webp 800w, /assets/img/feishu_docs_static/Qwbbb03SeowH97xjIjXc8IcPnye-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/feishu_docs_static/Qwbbb03SeowH97xjIjXc8IcPnye.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <h4 id="万兆网卡配光模块">万兆网卡配光模块</h4> <ul> <li>宝德服务器没有</li> </ul> <h4 id="高性能-sas-raid-卡及缓存">高性能 SAS RAID 卡及缓存</h4> <ul> <li>查看 SAS RAID 卡信息：<code class="language-plaintext highlighter-rouge">lspci -v -s $(lspci | grep -i raid |awk '{print $1}')</code> </li> </ul> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/feishu_docs_static/DpF8bawZoosXD0xgOuscT7iQnFh-480.webp 480w, /assets/img/feishu_docs_static/DpF8bawZoosXD0xgOuscT7iQnFh-800.webp 800w, /assets/img/feishu_docs_static/DpF8bawZoosXD0xgOuscT7iQnFh-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/feishu_docs_static/DpF8bawZoosXD0xgOuscT7iQnFh.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <ul> <li> <p>查看 SAS RAID 卡缓存</p> <ul> <li>1GB / 2GB</li> <li>应该是可以</li> </ul> </li> <li> <p>RAID 5</p> <ul> <li>宝德服务器上的 LSI MegaRAID SAS 9361-8i 是支持的：<a href="https://zhuanlan.zhihu.com/p/658803327" rel="external nofollow noopener" target="_blank">lsi9364-8i 阵列卡的不同版本介绍，全功能版比 lsi9361-8i 性价比高。 - 知乎 (zhihu.com)</a> </li> </ul> </li> </ul> <h4 id="硬盘数量">硬盘数量</h4> <h2 id="wsl-相关操作">wsl 相关操作</h2> <h3 id="重启-ssh">重启 ssh</h3> <ul> <li>和普通的 linux 不太一样！</li> </ul> <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sudo</span> <span class="s">service</span> <span class="s">ssh</span> <span class="s">--full-restart</span>
</code></pre></div></div> <h2 id="gpu-sharing">GPU Sharing</h2> <h3 id="概念学习文档">概念学习文档</h3> <ul> <li> <p>参考文献：</p> <ul> <li><a href="https://zw0610.github.io/notes-cn/gpu-sharing-1.html" rel="external nofollow noopener" target="_blank">GPU 共享一：你真的需要吗？ zw0610.github.io</a></li> <li><a href="https://zw0610.github.io/notes-cn/gpu-sharing-2.html" rel="external nofollow noopener" target="_blank">GPU 共享二：调度</a></li> <li><a href="https://zw0610.github.io/notes-cn/gpu-sharing-3.html" rel="external nofollow noopener" target="_blank">GPU 共享三：井水不犯河水 zw0610.github.io</a></li> <li><a href="https://zw0610.github.io/notes-cn/gpu-sharing-4.html" rel="external nofollow noopener" target="_blank">GPU 共享四：MIG 带来的补充 zw0610.github.io</a></li> </ul> </li> <li>各大公司的方案：<a href="https://blog.csdn.net/xixiaoyaoww/article/details/119901841" rel="external nofollow noopener" target="_blank">【精选】盘点来自工业界的 GPU 共享方案_夕小瑶的博客-CSDN 博客</a> </li> <li>从架构角度更详细一点的文章：<a href="https://asphelzhn.github.io/2019/04/14/tensor_09_MPS/" rel="external nofollow noopener" target="_blank">NVIDIA MPS 总结</a> </li> </ul> <h2 id="ssh-和-scp-相关的指令">SSH 和 SCP 相关的指令</h2> <h3 id="快速免密登录">快速免密登录</h3> <ul> <li>参考文献：<a href="https://blog.csdn.net/jeikerxiao/article/details/84105529" rel="external nofollow noopener" target="_blank">SSH 三步解决免密登录-CSDN 博客</a> </li> </ul> <div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 客户端（本地电脑，实验室电脑）生成公钥 id_rsa.pub 私钥 id_rsa</span>
ssh-keygen
<span class="c"># LINUX客户端公钥上传到远端</span>
ssh-copy-id -i ~/.ssh/id_rsa.pub "-p 51100 ubuntu@172.18.166.98"
# WINDOWS 将 ~/.ssh/id_rsa.pub 的内容复制到服务器的 ~/.ssh/authorized_keys
</code></pre></div></div> <h3 id="ssh-登录遇到的问题">ssh 登录遇到的问题</h3> <ul> <li>known_hosts 相关：<a href="https://cloud.tencent.com/developer/article/1851133" rel="external nofollow noopener" target="_blank">（SSH 体系下的公私密钥的介绍和使用技巧） - 腾讯云开发者社区-腾讯云 (tencent.com)</a> </li> <li>Ssh key 相关：<a href="https://blog.51cto.com/lxw1844912514/3065448" rel="external nofollow noopener" target="_blank">SSH 下 authorized_keys, id_rsa, id_rsa.pub, known_hosts 作用_51CTO 博客_.ssh/id_rsa</a> </li> <li>debug1: read_passphrase: can’t open /dev/tty: No such file or directory：<a href="https://best33.com/27.moe" rel="external nofollow noopener" target="_blank">连接 ssh 出现 Permission denied 之一解 - 三言三语 (best33.com)</a> </li> </ul> <h3 id="解决重启后无法-ssh">解决重启后无法 ssh</h3> <ul> <li>参考文献：<a href="https://blog.51cto.com/liuyunshengsir/5998127" rel="external nofollow noopener" target="_blank">ssh 设置免密后仍需要输入密码的解决方案_mb63bbbecf48728 的技术博客_51CTO 博客</a> <ul> <li>关键是要在服务端检查 sshd 的 log</li> </ul> </li> </ul> <h3 id="scp-传输文件和文件夹">scp 传输文件和文件夹</h3> <div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scp -P 远程端口 本地文件名 远程主机名@远程主机ip:远程主机保存文件位置

scp -P 远程端口 -r 本地文件夹 远程主机名@远程主机ip:远程主机保存文件位置
</code></pre></div></div> <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">scp</span> <span class="s">-P</span> <span class="s">远程端口</span> <span class="s">-r</span> <span class="s">本地文件夹</span> <span class="s">--exclude</span> <span class="s">'想要排除的文件名'</span> <span class="s">远程主机名@远程主机ip:远程主机保存文件位置</span>
</code></pre></div></div> <h3 id="ssh-远程执行脚本">ssh 远程执行脚本</h3> <div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 给文件增加执行权限</span>
chmod +x /home/ubuntu/jellyfish/test_ssh_remote.sh

<span class="c"># 远程执行</span>
ssh -n ubuntu@10.43.229.166 -p 22 /home/ubuntu/jellyfish/test_ssh_remote.sh
</code></pre></div></div> <h3 id="ssh-客户端会话超时机制">SSH 客户端会话超时机制</h3> <ul> <li>参考文献：<a href="https://zhuanlan.zhihu.com/p/154676017?utm_id=0" rel="external nofollow noopener" target="_blank">SSH 客户端会话超时设置 - 知乎 (zhihu.com)</a> </li> </ul> <h2 id="虚拟机">虚拟机</h2> <h3 id="vmware-虚拟机相关">vmware 虚拟机相关</h3> <ul> <li>参考文献：<a href="https://www.jianshu.com/p/b52baa703f4b" rel="external nofollow noopener" target="_blank">虚拟机安装 Ubuntu，磁盘空间未全部利用 - 简书 (jianshu.com)</a> </li> </ul> <h3 id="kvm-虚拟机">KVM 虚拟机</h3> <ul> <li>相关指令：<a href="https://blog.csdn.net/wh211212/article/details/74908390" rel="external nofollow noopener" target="_blank">KVM 操作虚拟机常用命令_shaonbean 的博客-CSDN 博客</a> </li> <li>使用 virsh 查看虚拟机的 ip 和 mac 地址：<a href="https://blog.csdn.net/kevinsingapore/article/details/82021901" rel="external nofollow noopener" target="_blank">kvm 虚拟机利用 virsh 查看 ip_kevinsingapore 的博客-CSDN 博客_virsh 查看虚拟机 ip</a> </li> </ul> <h2 id="解压压缩命令索引">解压/压缩命令索引</h2> <ul> <li>参考文献：<a href="https://blog.csdn.net/fu6543210/article/details/79845781" rel="external nofollow noopener" target="_blank">https://blog.csdn.net/fu6543210/article/details/79845781</a> </li> </ul> <h3 id="targz-压缩">tar.gz 压缩</h3> <ul> <li>tar zxvf MY_NAME.tar.gz</li> </ul> <h3 id="tgz-压缩">tgz 压缩</h3> <ul> <li>tar zxvf MY_NAME.tgz</li> </ul> <h3 id="gz-压缩">.gz 压缩</h3> <ul> <li>参考文献：<a href="https://cloud.tencent.com/developer/article/1652775" rel="external nofollow noopener" target="_blank">如何解压 GZ 文件 - 腾讯云开发者社区-腾讯云 (tencent.com)</a> </li> <li>gzip -d file.gz： 这个命令将会将压缩文件解压缩，并且移除.gz 文件。</li> <li>gzip -dk file.gz：保持压缩文件不变，传递-k 选项给命令</li> </ul> <h3 id="zip-压缩">.zip 压缩</h3> <ul> <li>unzip -d 目标目录 .zip 文件</li> </ul> <p>##</p> <p>##</p> <p>##</p> <h2 id="gcloudgsutil-下载文件">gcloud/gsutil 下载文件</h2> <ul> <li>参考 chatgpt 的解决方案</li> <li> <p>使用 <code class="language-plaintext highlighter-rouge">gsutil</code> 工具或 <code class="language-plaintext highlighter-rouge">gcloud</code> 命令行工具来下载这些文件，前提是你已经进行了身份验证并具有相应的权限。以下是使用 <code class="language-plaintext highlighter-rouge">gsutil</code> 下载文件的示例：</p> <ul> <li>安装 <code class="language-plaintext highlighter-rouge">gsutil</code>（如果尚未安装）：<code class="language-plaintext highlighter-rouge">curl https://sdk.cloud.google.com | bash</code> </li> <li>安装完成后，执行以下命令以设置 <code class="language-plaintext highlighter-rouge">gsutil</code>：<code class="language-plaintext highlighter-rouge">exec -l $SHELL</code> </li> <li>使用 <code class="language-plaintext highlighter-rouge">gsutil</code> 下载文件：gsutil cp gs://waymo_open_dataset_v_1_0_0/training/training_0001.tar .</li> </ul> </li> <li> <p>请确保你已经进行了身份验证并且具有下载所需文件的权限。如果需要登录到 Google 帐户并获取访问权限，请使用 <code class="language-plaintext highlighter-rouge">gcloud</code> 命令行工具进行身份验证和授权。</p> <ul> <li>初始化身份验证和授权：gcloud init</li> </ul> </li> </ul> <h2 id="代理源相关">代理/源相关</h2> <ul> <li> <p>wget 代理</p> <ul> <li>参考文献：</li> <li>直接加上 -e “[ip]:[port]”</li> </ul> </li> <li>apt 源修改</li> <li> <p>Ubuntu 源修改</p> <ul> <li>参考文献</li> </ul> </li> </ul> <h2 id="gpu-模式设置">GPU 模式设置</h2> <ul> <li>参考文献；<a href="https://juejin.cn/post/7120533024076202015" rel="external nofollow noopener" target="_blank">NVIDIA-SMI 系列命令详解(7)-设备修改选项(2) - 掘金 (juejin.cn)</a> </li> </ul> <h2 id="cuda-相关的指令">Cuda 相关的指令</h2> <h3 id="查看-cuda-版本">查看 cuda 版本</h3> <p>nvcc –version</p> <h3 id="cuda-多版本切换">cuda 多版本切换</h3> <ul> <li>参考文献：<a href="https://blog.crazybunqnq.com/2022/09/22/multipleversionsnivdiamanage/" rel="external nofollow noopener" target="_blank">多版本 CUDA 及 cuDNN 管理 CrazyBun (crazybunqnq.com)</a> </li> <li><a href="https://zhuanlan.zhihu.com/p/520536351" rel="external nofollow noopener" target="_blank">备选参考文献： CUDA 的正确安装/升级/重装/使用方式 - 知乎 (zhihu.com)</a></li> </ul> <h3 id="安装-nvidia-driver">安装 nvidia driver</h3> <ul> <li>参考文献：<a href="https://blog.csdn.net/sinat_34686158/article/details/106845208" rel="external nofollow noopener" target="_blank">超全超详细的安装 nvidia 显卡驱动教程_ubuntu 安装显卡驱动-CSDN 博客</a> </li> <li>下载.run 文件，直接安装即可？</li> </ul> <h3 id="安装-cudnn">安装 cudnn</h3> <ul> <li>[该方案存在 bug]参考文献：<a href="https://www.jianshu.com/p/55551695e7e2" rel="external nofollow noopener" target="_blank">ubuntu 安装 cuda10.2 以及 cudnn7.6.5 - 简书 (jianshu.com)</a> </li> <li>[似乎可以修复上述方案中 bug 的解决方案]：<a href="https://blog.csdn.net/MacwinWin/article/details/80236111" rel="external nofollow noopener" target="_blank">解决 CuDNN runtime 版本和编译版本不同的问题_libcudnn.so 不同版本-CSDN 博客</a> </li> </ul> <h2 id="linux-权限相关操作">Linux 权限相关操作</h2> <ul> <li> <p>Linux sudo 权限：</p> <ul> <li> <ol> <li>加组；</li> </ol> </li> <li> <ol> <li>使用 login shell 打开【踩坑记录：<a href="https://github.com/microsoft/vscode/issues/7263" rel="external nofollow noopener" target="_blank">https://github.com/microsoft/vscode/issues/7263</a>； <a href="https://github.com/microsoft/vscode-remote-release/issues/1671" rel="external nofollow noopener" target="_blank">https://github.com/microsoft/vscode-remote-release/issues/1671</a>】</li> </ol> </li> </ul> </li> <li> <p>危险的 777 权限：<a href="https://juejin.cn/post/6844903694509539336" rel="external nofollow noopener" target="_blank">https://juejin.cn/post/6844903694509539336</a></p> </li> </ul> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">增加读权限</span><span class="err">：</span>
<span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">chmod</span> <span class="o">+</span><span class="n">r</span> <span class="n">filename</span> 
<span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">增加写权限</span><span class="err">：</span>
<span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">chmod</span> <span class="o">+</span><span class="n">w</span> <span class="n">filename</span> 
<span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">增加执行权限</span><span class="err">：</span>
<span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">filename</span> 
<span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">同时增加多个权限</span><span class="err">：</span>
<span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">chmod</span> <span class="o">+</span><span class="n">rw</span> <span class="n">filename</span> <span class="err">#</span> <span class="n">增加读和写权限</span> 
<span class="n">chmod</span> <span class="o">+</span><span class="n">rx</span> <span class="n">filename</span> <span class="err">#</span> <span class="n">增加读和执行权限</span> 
<span class="n">chmod</span> <span class="o">+</span><span class="n">wx</span> <span class="n">filename</span> <span class="err">#</span> <span class="n">增加写和执行权限</span> 
<span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">移除权限</span><span class="err">：</span>
<span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">chmod</span> <span class="o">-</span><span class="n">r</span> <span class="n">filename</span> <span class="err">#</span> <span class="n">移除读权限</span> 
<span class="n">chmod</span> <span class="o">-</span><span class="n">w</span> <span class="n">filename</span> <span class="err">#</span> <span class="n">移除写权限</span> 
<span class="n">chmod</span> <span class="o">-</span><span class="n">x</span> <span class="n">filename</span> <span class="err">#</span> <span class="n">移除执行权限</span> 
<span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">设置特定权限</span><span class="err">（</span><span class="n">例如</span><span class="err">，</span><span class="n">设置所有者具有读写权限</span><span class="err">，</span><span class="n">组用户具有读权限</span><span class="err">，</span><span class="n">其他用户具有读权限</span><span class="err">）：</span>
<span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">chmod</span> <span class="n">u</span><span class="o">=</span><span class="n">rw</span><span class="p">,</span><span class="k">go</span><span class="o">=</span><span class="n">r</span> <span class="n">filename</span>
</code></pre></div></div> <h2 id="进程与线程相关操作">进程与线程相关操作</h2> <h3 id="寻找父进程下的子进程">寻找父进程下的子进程</h3> <ul> <li>pgrep -P <pid></pid> </li> </ul> <h3 id="检查进程的文件和网络请求">检查进程的文件和网络请求</h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls /proc/&lt;pid&gt;/fd

lsof -p &lt;pid&gt; # 这个指令可以检查到所有的情况, 通常可以加上 `| grep TCP` 来检索TCP链接
</code></pre></div></div> <h2 id="shell-与sh-脚本">Shell 与.sh 脚本</h2> <h3 id="oh-my-zsh-危险的-shell">Oh-my-zsh 危险的 shell</h3> <ul> <li> <p>安装方法：</p> <ul> <li><a href="https://segmentfault.com/a/1190000015283092" rel="external nofollow noopener" target="_blank">linux - Ubuntu 下 Oh My Zsh 的最佳实践「安装及配置」 - 比特麒麟的全栈之路 - SegmentFault 思否</a></li> </ul> </li> <li> <p>优雅的删除 zsh 的方法：</p> <ul> <li><a href="https://askubuntu.com/questions/963874/uninstall-oh-my-zsh" rel="external nofollow noopener" target="_blank">参考文献： command line - Uninstall Oh My Zsh - Ask Ubuntu</a></li> </ul> </li> </ul> <div class="language-perl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">sh</span> <span class="o">~</span><span class="sr">/.oh-my-zsh/</span><span class="nv">tools</span><span class="o">/</span><span class="nv">uninstall</span><span class="o">.</span><span class="nv">sh</span> 

<span class="nv">Are</span> <span class="nv">you</span> <span class="nv">sure</span> <span class="nv">you</span> <span class="nv">want</span> <span class="nv">to</span> <span class="nv">remove</span> <span class="nv">Oh</span> <span class="nv">My</span> <span class="nv">Zsh</span><span class="p">?</span> <span class="p">[</span><span class="sr">y/N] y
Removing ~/.oh-my-zsh
Found ~/</span><span class="o">.</span><span class="nv">zshrc</span> <span class="o">--</span> <span class="nv">Renaming</span> <span class="nv">to</span> <span class="sr">/home/u</span><span class="nv">buntu</span><span class="o">/.</span><span class="nv">zshrc</span><span class="o">.</span><span class="nv">omz</span><span class="o">-</span><span class="nv">uninstalled</span><span class="o">-</span><span class="mi">2023</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">09_10</span><span class="o">-</span><span class="mi">41</span><span class="o">-</span><span class="mi">54</span>
<span class="nv">Looking</span> <span class="k">for</span> <span class="nv">original</span> <span class="nv">zsh</span> <span class="nv">config</span><span class="o">...</span>
<span class="nv">No</span> <span class="nv">original</span> <span class="nv">zsh</span> <span class="nv">config</span> <span class="nv">found</span>
<span class="nv">Thanks</span> <span class="k">for</span> <span class="nv">trying</span> <span class="nv">out</span> <span class="nv">Oh</span> <span class="nv">My</span> <span class="nv">Zsh</span><span class="o">.</span> <span class="nv">It</span><span class="p">'</span><span class="s1">s been uninstalled.
Don</span><span class="p">'</span><span class="nv">t</span> <span class="nv">forget</span> <span class="nv">to</span> <span class="nv">restart</span> <span class="nv">your</span> <span class="nv">terminal</span><span class="o">!</span>
</code></pre></div></div> <h3 id="如何通过-grub-进入安全模式修改启动脚本为-shell">如何通过 grub 进入安全模式修改启动脚本为 shell</h3> <ul> <li>参考文献：<a href="https://trendoceans.com/how-to-fix-login-issue-after-removing-zsh-from-debian-ubuntu/" rel="external nofollow noopener" target="_blank">[Solved] Fix login issue after removing zsh from Debian/Ubuntu - TREND OCEANS</a> </li> <li>第一步：进入 grub【一般是先进入 bios，然后马上退出，退出的时候按一下 ESC 即可进入。不要按太多次】</li> <li>第二步，按 e 进入编辑模式，然后在 linux 的那一行加入 quiet 1，并按 ctrl-x 退出，即可进入安全模式</li> </ul> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/feishu_docs_static/FjBlb1GoAorbGvx7hh3caol3nlc-480.webp 480w, /assets/img/feishu_docs_static/FjBlb1GoAorbGvx7hh3caol3nlc-800.webp 800w, /assets/img/feishu_docs_static/FjBlb1GoAorbGvx7hh3caol3nlc-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/feishu_docs_static/FjBlb1GoAorbGvx7hh3caol3nlc.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <ul> <li>第三步，<strong>nano /etc/passwd 。</strong>修改 root 用户和当前用户的登录 shell</li> </ul> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="no">Before</span>
<span class="n">root</span><span class="ss">:x</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="ss">:root:/</span><span class="n">root</span><span class="ss">:/</span><span class="n">bin</span><span class="o">/</span><span class="n">zsh</span>
<span class="o">&lt;</span><span class="n">your_user_name</span><span class="o">&gt;</span><span class="ss">:x</span><span class="p">:</span><span class="mi">1000</span><span class="p">:</span><span class="mi">1000</span><span class="ss">:&lt;</span><span class="n">your_user_name</span><span class="o">&gt;</span><span class="p">,,,</span><span class="ss">:/</span><span class="n">home</span><span class="o">/&lt;</span><span class="n">your_user_name</span><span class="o">&gt;</span><span class="ss">:/</span><span class="n">bin</span><span class="o">/</span><span class="n">zsh</span>
<span class="no">After</span>
<span class="n">root</span><span class="ss">:x</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="ss">:root:/</span><span class="n">root</span><span class="ss">:/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="o">&lt;</span><span class="sr">/strong&gt;&lt;strong&gt;&lt;your_user_name&gt;:x:1000:1000:&lt;your_user_name&gt;,,,:/</span><span class="n">home</span><span class="o">/&lt;</span><span class="n">your_user_name</span><span class="o">&gt;</span><span class="ss">:/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span><span class="o">&lt;</span><span class="sr">/strong&gt;
</span></code></pre></div></div> <ul> <li>第四步，回到默认模式，重启主机</li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;strong&gt;systemctl default
&lt;/strong&gt;&lt;strong&gt;exit&lt;/strong&gt;
</code></pre></div></div> <h3 id="bash-相关指令">bash 相关指令</h3> <ul> <li>参考资料：<a href="https://blog.51cto.com/u_15127625/2731367" rel="external nofollow noopener" target="_blank">linux 下/etc/profile /etc/bashrc /root/.bashrc /root/.bash_profile 这四个配置文件的加载顺序_51CTO 博客_linux 下的命令</a> </li> <li> <p>四种不同的环境变量配置</p> <ul> <li>/etc/profile 设置的是系统全局环境和登录系统的一些配置，该配置对所有用户生效；</li> <li>/etc/bashrc 是 shell 全局自定义配置文件，主要用于自定义 shell，该配置对所有用户的 shell 都生效；</li> <li>/root/.bashrc 用于单独自定义 root 用户的 bash，只对 root 用户的 bash 生效，如果要使 elk 用户生效，则需要配置/home/elk/.bashrc 文件；</li> <li>/root/.bash_profile 用于单独自定义 root 用户的系统环境,只对 root 用户生效，如果要使 elk 用户生效，则需要配置/home/elk/.bash_profile。</li> </ul> </li> <li>生效的顺序：/etc/profile &gt; /etc/bashrc &gt; /root/.bashrc &gt; /root/.bash_profile</li> </ul> <h3 id="bash-避免环境变量出错的增加写法">bash 避免环境变量出错的增加写法</h3> <div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export LD_LIBRARY_PATH=/usr/local/cuda-11.6/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
</code></pre></div></div> <h3 id="sh-脚本相关">.sh 脚本相关</h3> <h4 id="和和-">$!和$?和 $#</h4> <ol> <li> <p><code class="language-plaintext highlighter-rouge">$!</code>：</p> <ul> <li>含义：<code class="language-plaintext highlighter-rouge">$!</code> 表示最后一个在后台运行的作业（进程）的进程 ID。</li> <li>作用：通常用于在后台运行一个任务后，获取该任务的进程 ID，以便后续监控、控制或等待该任务的完成。</li> </ul> </li> <li> <p><code class="language-plaintext highlighter-rouge">$?</code>：</p> <ul> <li>含义：<code class="language-plaintext highlighter-rouge">$?</code> 表示上一个命令的退出状态码（返回值）。当一个命令成功执行时，其退出状态码通常为 0，如果出现错误或失败，状态码会是一个非零值，具体的值通常用于指示失败的原因。</li> <li>作用：主要用于判断上一个命令是否成功执行。通常在脚本中，可以根据 <code class="language-plaintext highlighter-rouge">$?</code> 的值来决定下一步的操作，例如，根据不同的状态码采取不同的处理方式。</li> </ul> </li> <li> <p><code class="language-plaintext highlighter-rouge">$#</code>：</p> <ol> <li>含义：获取命令行参数的个数。</li> </ol> </li> </ol> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="c"># 执行一个命令，假设这个命令是成功的</span>
<span class="nb">ls</span>

<span class="c"># 检查上一个命令的退出状态码</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"命令执行成功"</span>
<span class="k">else
  </span><span class="nb">echo</span> <span class="s2">"命令执行失败"</span>
<span class="k">fi</span>

<span class="c"># 后台运行一个命令，并获取其进程 ID</span>
<span class="nb">sleep </span>10 &amp;
<span class="nv">background_pid</span><span class="o">=</span><span class="nv">$!</span>
<span class="nb">echo</span> <span class="s2">"后台进程 ID：</span><span class="nv">$background_pid</span><span class="s2">"</span>

<span class="c"># 模拟一个失败的命令</span>
<span class="nb">ls</span> /nonexistent_directory

<span class="c"># 再次检查上一个命令的退出状态码</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"命令执行成功"</span>
<span class="k">else
  </span><span class="nb">echo</span> <span class="s2">"命令执行失败"</span>
<span class="k">fi</span>

./myscript.sh arg1 arg2 arg3  

<span class="nb">echo</span> <span class="s2">"参数个数: "</span> <span class="nv">$# </span> <span class="c"># 3</span>
</code></pre></div></div> <h4 id="批量将文件里面的字段修改成需求字段的脚本">批量将文件里面的字段修改成需求字段的脚本</h4> <ol> <li> <code class="language-plaintext highlighter-rouge">find "${clients_cfg_dir}/.temp/"</code>：使用 <code class="language-plaintext highlighter-rouge">find</code> 命令来查找文件和目录，<code class="language-plaintext highlighter-rouge">${clients_cfg_dir}/.temp/</code> 是查找的起始目录，表示从这个目录开始进行查找。</li> <li> <code class="language-plaintext highlighter-rouge">-type f</code>：这是 <code class="language-plaintext highlighter-rouge">find</code> 命令的选项，指定只查找文件（而不是目录或其他类型的文件）。 <code class="language-plaintext highlighter-rouge">-type f</code> 表示查找普通文件。</li> <li> <p><code class="language-plaintext highlighter-rouge">-exec sed -i "s/client_ip/${client_ip}/g" {} \;</code>：当 <code class="language-plaintext highlighter-rouge">find</code> 找到一个文件后，执行 <code class="language-plaintext highlighter-rouge">-exec</code> 后面的命令。在这里，<code class="language-plaintext highlighter-rouge">sed -i "s/client_ip/${client_ip}/g" {}</code> 表示对找到的文件执行 <code class="language-plaintext highlighter-rouge">sed</code> 命令，将文件中的所有 <code class="language-plaintext highlighter-rouge">client_ip</code> 字符串替换为 <code class="language-plaintext highlighter-rouge">${client_ip}</code>。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">sed</code>：用于处理文本流的工具，这里用于替换文本。</li> <li> <code class="language-plaintext highlighter-rouge">-i</code>：<code class="language-plaintext highlighter-rouge">sed</code> 的选项，表示直接在原始文件上进行修改，而不是在标准输出中显示结果。</li> <li> <code class="language-plaintext highlighter-rouge">"s/client_ip/${client_ip}/g"</code>：<code class="language-plaintext highlighter-rouge">sed</code> 的替换命令，将文件中的所有 <code class="language-plaintext highlighter-rouge">client_ip</code> 替换为 <code class="language-plaintext highlighter-rouge">${client_ip}</code>。</li> <li> <code class="language-plaintext highlighter-rouge">{}</code>：这个占位符会被 <code class="language-plaintext highlighter-rouge">find</code> 命令找到的文件名所替代。</li> <li> <code class="language-plaintext highlighter-rouge">\;</code>：表示 <code class="language-plaintext highlighter-rouge">-exec</code> 命令结束。</li> </ul> </li> </ol> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find <span class="s2">"</span><span class="k">${</span><span class="nv">clients_cfg_dir</span><span class="k">}</span><span class="s2">/.temp/"</span> <span class="nt">-type</span> f <span class="nt">-exec</span> <span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s/client_ip/</span><span class="k">${</span><span class="nv">client_ip</span><span class="k">}</span><span class="s2">/g"</span> <span class="o">{}</span> <span class="se">\;</span>
</code></pre></div></div> <h4 id="判断条件">判断条件</h4> <ul> <li> <p>判断当前文件夹下面是否有文件</p> <ul> <li><code class="language-plaintext highlighter-rouge">[ -e temp_clients_pid.txt ]</code></li> </ul> </li> <li> <p>判断字符串是否为空</p> <ul> <li><code class="language-plaintext highlighter-rouge">[ -z "${network_trace_type}" ]</code></li> </ul> </li> </ul> <h4 id="trap-截获指令操作">trap 截获指令操作</h4> <p><code class="language-plaintext highlighter-rouge">trap "stop" SIGHUP SIGINT SIGTERM</code></p> <ul> <li> <code class="language-plaintext highlighter-rouge">trap</code> 是一个 Shell 命令，用于捕获（trap）或处理信号。</li> <li> <p><code class="language-plaintext highlighter-rouge">SIGHUP</code>, <code class="language-plaintext highlighter-rouge">SIGINT</code>, 和 <code class="language-plaintext highlighter-rouge">SIGTERM</code> 是三种不同的信号，它们分别表示：</p> <ul> <li> <code class="language-plaintext highlighter-rouge">SIGHUP</code>：挂起信号（Hang Up），通常由终端关闭引发。</li> <li> <code class="language-plaintext highlighter-rouge">SIGINT</code>：中断信号（Interrupt），通常由用户在终端按下 Ctrl+C 引发。</li> <li> <code class="language-plaintext highlighter-rouge">SIGTERM</code>：终止信号（Terminate），通常用于请求进程正常终止。</li> </ul> </li> <li> <p><code class="language-plaintext highlighter-rouge">"stop"</code> 是在接收到上述信号时要执行的命令。</p> <ul> <li> <code class="language-plaintext highlighter-rouge">while IFS= read -r pid; do ... done &lt; temp_clients_pid.txt</code> 表示逐行读 temp_clients_pid.txt 的内容，并每次赋值给 pid 变量</li> </ul> </li> </ul> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>stop<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"Stopping..."</span>
  <span class="k">while </span><span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> <span class="nt">-r</span> pid<span class="p">;</span> <span class="k">do
    </span><span class="nb">kill</span> <span class="nt">-TERM</span> <span class="k">${</span><span class="nv">pid</span><span class="k">}</span>
    <span class="nb">wait</span> <span class="nv">$pid</span>
    <span class="nb">echo</span> <span class="s2">"Finshed pid </span><span class="k">${</span><span class="nv">pid</span><span class="k">}</span><span class="s2">"</span>
  <span class="k">done</span> &lt; temp_clients_pid.txt 
  <span class="nb">rm </span>temp_clients_pid.txt
  <span class="nb">exit</span>  
<span class="o">}</span>
<span class="nb">trap</span> <span class="s2">"stop"</span> SIGHUP SIGINT SIGTERM
</code></pre></div></div> <h2 id="linux-安装多版本-gccg">linux 安装多版本 gcc/g++</h2> <p>在 Linux 上安装多个 GCC 版本并支持多版本切换可以使用工具如 <code class="language-plaintext highlighter-rouge">update-alternatives</code> 来管理。以下是在 Linux 上安装多个 GCC 版本的一般步骤：</p> <ol> <li> <strong>（新版本）安装所需的</strong><strong>GCC</strong><strong>版本：</strong> </li> </ol> <p>首先，您需要安装额外的 GCC 版本。对于 GCC 10.0，您可以使用包管理器来安装：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
   <span class="nb">sudo </span>apt <span class="nb">install </span>gcc-10 g++-10
</code></pre></div></div> <p>这将安装 GCC 10.0 和相应的 g++。</p> <ol> <li> <strong>（老版本）安装所需的</strong><strong>GCC</strong><strong>版本：</strong> </li> </ol> <ul> <li>参考文献：<a href="https://blog.csdn.net/weixin_44120025/article/details/121318588" rel="external nofollow noopener" target="_blank">ubuntu 安装 g++-5 和 gcc-5 并实现多版本 g++ 和 gcc 之间的管理和切换教程-CSDN 博客</a> </li> </ul> <ol> <li> <strong>使用</strong><strong>update-alternatives</strong><strong>设置默认版本：</strong> </li> </ol> <p><code class="language-plaintext highlighter-rouge">update-alternatives</code> 是一个用于管理 Linux 系统上可替代项的工具。您可以使用它来配置系统上的不同 GCC 版本。</p> <p>首先，添加 GCC 10.0 到 <code class="language-plaintext highlighter-rouge">update-alternatives</code> 中：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>update-alternatives <span class="nt">--install</span> /usr/bin/gcc gcc /usr/bin/gcc-10 100
   <span class="nb">sudo </span>update-alternatives <span class="nt">--install</span> /usr/bin/g++ g++ /usr/bin/g++-10 100
</code></pre></div></div> <p>上述命令将 GCC 10.0 和 g++ 10.0 添加到备选列表中，并设置优先级为 100（可以根据需要进行更改）。</p> <ol> <li><strong>配置默认版本：</strong></li> </ol> <p>使用以下命令选择默认版本：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>update-alternatives <span class="nt">--config</span> gcc
</code></pre></div></div> <p>然后，选择您希望作为默认版本的 GCC。重复此步骤以选择默认的 g++ 版本。</p> <ol> <li> <strong>验证</strong><strong>GCC</strong><strong>版本：</strong> </li> </ol> <p>您可以使用以下命令验证已安装的 GCC 版本：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc <span class="nt">--version</span>
   g++ <span class="nt">--version</span>
</code></pre></div></div> <p>确保显示的版本号与您选择的默认版本一致。</p> <ol> <li><strong>切换版本：</strong></li> </ol> <p>每次需要更改 GCC 版本时，您可以使用 <code class="language-plaintext highlighter-rouge">update-alternatives</code> 来切换。例如，要切换到 GCC 11.4.0：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>update-alternatives <span class="nt">--config</span> gcc
</code></pre></div></div> <p>然后选择 GCC 11.4.0 作为默认版本。</p> <p>通过这些步骤，您可以在 Linux 系统上同时安装多个 GCC 版本，并根据需要进行切换。请注意，确保备份项目并测试切换是否正常工作，以避免潜在的兼容性问题。</p> <h2 id="docker-相关的-linux-指令">Docker 相关的 Linux 指令</h2> <h3 id="安装教程">安装教程</h3> <ul> <li>参考文献：<a href="https://docs.docker.com/engine/install/ubuntu/" rel="external nofollow noopener" target="_blank">Install Docker Engine on Ubuntu Docker Docs</a> </li> </ul> <h3 id="解决权限问题">解决权限问题</h3> <ul> <li>参考文献：<a href="https://blog.csdn.net/qq_22496815/article/details/115804223" rel="external nofollow noopener" target="_blank">解决 Docker 安装后权限问题 Got permission denied while trying to connect to the Docker daemon socket_小可爱 bling 的博客-CSDN 博客</a> </li> <li>个人感觉这个方法会比较好！</li> </ul> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>groupadd docker <span class="c">#添加docker用户组</span>
 
<span class="nb">sudo </span>gpasswd <span class="nt">-a</span> <span class="nv">$USER</span> docker <span class="c">#将登陆用户加入到docker用户组中</span>
 
newgrp docker  <span class="c">#更新用户组</span>
</code></pre></div></div> <h3 id="docker-登录操作">Docker 登录操作</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docker</span> <span class="n">login</span>
</code></pre></div></div> <h3 id="docker-将自己的-image-分享到-dockerhub">Docker 将自己的 image 分享到 dockerhub</h3> <div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 首先要打tag</span>
<span class="c"># 要加上自己的用户名</span>
docker tag legion_ci_2004 xlcbingo1999/legion_ci_2004
docker push xlcbingo1999/legion_ci_2004
</code></pre></div></div> <h3 id="docker-将当前容器的状态重新生成-image">Docker 将当前容器的状态重新生成 Image</h3> <ul> <li>参考文献：<a href="https://www.cnblogs.com/diantong/p/11519467.html" rel="external nofollow noopener" target="_blank">Docker 容器（二）——镜像制作 - 苦逼运维 - 博客园 (cnblogs.com)</a> </li> <li>示例场景：</li> </ul> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">root</span><span class="vi">@youxi1</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker images</span>
<span class="no">REPOSITORY</span>                     <span class="no">TAG</span>                 <span class="no">IMAGE</span> <span class="no">ID</span>            <span class="no">CREATED</span>             <span class="no">SIZE</span>
<span class="n">centos</span>                         <span class="n">latest</span>              <span class="mi">67</span><span class="n">fa590cfc1c</span>        <span class="mi">3</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="mi">202</span><span class="no">MB</span>
<span class="n">hub</span><span class="p">.</span><span class="nf">c</span><span class="o">.</span><span class="mi">163</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">tomcat</span>   <span class="n">latest</span>              <span class="mi">72</span><span class="n">d2be374029</span>        <span class="mi">2</span> <span class="n">years</span> <span class="n">ago</span>         <span class="mi">292</span><span class="no">MB</span>
<span class="p">[</span><span class="n">root</span><span class="vi">@youxi1</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker run -it centos:latest /bin/bash</span>
<span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="mi">985</span><span class="n">ef7e0c4ca</span> <span class="sr">/]# yum -y install httpd
[root@985ef7e0c4ca /</span><span class="p">]</span><span class="c1"># exit</span>
<span class="nb">exit</span>

<span class="p">[</span><span class="n">root</span><span class="vi">@youxi1</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker ps -a</span>
<span class="no">CONTAINER</span> <span class="no">ID</span>        <span class="no">IMAGE</span>               <span class="no">COMMAND</span>             <span class="no">CREATED</span>             <span class="no">STATUS</span>                     <span class="no">PORTS</span>               <span class="no">NAMES</span>
<span class="mi">985</span><span class="n">ef7e0c4ca</span>        <span class="n">centos</span><span class="ss">:latest</span>       
<span class="s2">"/bin/bash"</span>         
<span class="mi">4</span> <span class="n">minutes</span> <span class="n">ago</span>       <span class="no">Exited</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="mi">2</span> <span class="n">minutes</span> <span class="n">ago</span>                       <span class="n">sharp_kare</span>
<span class="mi">9</span><span class="n">a81af9b4134</span>        <span class="n">centos</span><span class="ss">:latest</span>       
<span class="s2">"/bin/bash"</span>         
<span class="mi">2</span> <span class="n">days</span> <span class="n">ago</span>          <span class="no">Exited</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="mi">2</span> <span class="n">days</span> <span class="n">ago</span>                          <span class="n">pensive_dijkstra</span>
<span class="mi">3</span><span class="n">ecc9bafd429</span>        <span class="n">centos</span><span class="ss">:latest</span>       
<span class="s2">"/bin/bash"</span>         
<span class="mi">2</span> <span class="n">days</span> <span class="n">ago</span>          <span class="no">Exited</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="mi">2</span> <span class="n">days</span> <span class="n">ago</span>                          <span class="n">sleepy_wilbur</span>
<span class="p">[</span><span class="n">root</span><span class="vi">@youxi1</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker commit 985ef7e0c4ca centos:httpd</span>
<span class="n">sha256</span><span class="ss">:bdd371e6f1cf035bd501c09b28a2b2827900973a0defa9e35eadcd2f2f55e5e4</span>
<span class="p">[</span><span class="n">root</span><span class="vi">@youxi1</span> <span class="o">~</span><span class="p">]</span><span class="c1"># docker images</span>
<span class="no">REPOSITORY</span>                     <span class="no">TAG</span>                 <span class="no">IMAGE</span> <span class="no">ID</span>            <span class="no">CREATED</span>             <span class="no">SIZE</span>
<span class="n">centos</span>                         <span class="n">httpd</span>               <span class="n">bdd371e6f1cf</span>        <span class="mi">14</span> <span class="n">seconds</span> <span class="n">ago</span>      <span class="mi">346</span><span class="no">MB</span>
<span class="n">centos</span>                         <span class="n">latest</span>              <span class="mi">67</span><span class="n">fa590cfc1c</span>        <span class="mi">3</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="mi">202</span><span class="no">MB</span>
<span class="n">hub</span><span class="p">.</span><span class="nf">c</span><span class="o">.</span><span class="mi">163</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">tomcat</span>   <span class="n">latest</span>              <span class="mi">72</span><span class="n">d2be374029</span>        <span class="mi">2</span> <span class="n">years</span> <span class="n">ago</span>         <span class="mi">292</span><span class="no">MB</span>
</code></pre></div></div> <h3 id="docker-中使用-sshd">Docker 中使用 sshd</h3> <p><a href="https://zhuanlan.zhihu.com/p/113962350" rel="external nofollow noopener" target="_blank">SSH 连接 docker 中的 container - 知乎 (zhihu.com)</a></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">apt</span><span class="o">-</span><span class="k">get</span> <span class="k">update</span>
<span class="n">apt</span><span class="o">-</span><span class="k">get</span> <span class="n">install</span> <span class="n">passwd</span> <span class="n">openssl</span> <span class="n">openssh</span><span class="o">-</span><span class="n">server</span>

<span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span>
<span class="n">service</span> <span class="n">ssh</span> <span class="k">restart</span>
</code></pre></div></div> <h3 id="docker-镜像相关操作">Docker 镜像相关操作</h3> <ul> <li>查看所有的镜像</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span>
</code></pre></div></div> <h3 id="docker-运行中的容器相关操作">Docker 运行中的容器相关操作</h3> <ul> <li>查看运行中的容器</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docker</span> <span class="n">ps</span>
</code></pre></div></div> <h3 id="docker-启动容器">Docker 启动容器</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">gpus</span> <span class="nb">all</span> <span class="o">-</span><span class="n">it</span> <span class="o">&lt;</span><span class="n">image_name</span><span class="o">&gt;</span>
</code></pre></div></div> <h3 id="docker-中使用宿主机的代理">Docker 中使用宿主机的代理</h3> <ul> <li>参考文献：<a href="https://kebingzao.com/2019/02/22/docker-container-proxy/" rel="external nofollow noopener" target="_blank">docker 容器内使用宿主机的代理配置 Zach Ke’s Notes (kebingzao.com)</a> </li> <li>解决方案【17.0 版本之后】：直接在宿主机上配置 docker 的代理即可，启动容器的时候会自动把代理信息注入容器的</li> </ul> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div> <h3 id="docker-中修改源">Docker 中修改源</h3> <ul> <li>参考文献：<a href="https://blog.csdn.net/qq_44797987/article/details/112681224" rel="external nofollow noopener" target="_blank">Docker 配置国内源加速(2023/05/14)_docker 国内镜像源_Hit 不死的小强的博客-CSDN 博客</a> </li> </ul> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 编辑 Docker 配置文件</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="n">vim</span> <span class="sr">/etc/</span><span class="n">docker</span><span class="o">/</span><span class="n">daemon</span><span class="p">.</span><span class="nf">json</span>
<span class="c1"># 加入以下配置项</span>
<span class="p">{</span>
    <span class="s2">"registry-mirrors"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"https://dockerproxy.com"</span><span class="p">,</span>
        <span class="s2">"https://hub-mirror.c.163.com"</span><span class="p">,</span>
        <span class="s2">"https://mirror.baidubce.com"</span><span class="p">,</span>
        <span class="s2">"https://ccr.ccs.tencentyun.com"</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="err">$</span> <span class="n">sudo</span> <span class="n">service</span> <span class="n">docker</span> <span class="n">restart</span>

<span class="c1"># 查看 Docker 信息</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="n">docker</span> <span class="n">info</span>

<span class="c1"># 出现以下字段代表配置成功</span>
<span class="no">Registry</span> <span class="no">Mirrors</span><span class="p">:</span>
  <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">dockerproxy</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span>
  <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">hub</span><span class="o">-</span><span class="n">mirror</span><span class="p">.</span><span class="nf">c</span><span class="o">.</span><span class="mi">163</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span>
  <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">mirror</span><span class="p">.</span><span class="nf">baidubce</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span>
  <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">ccr</span><span class="p">.</span><span class="nf">ccs</span><span class="p">.</span><span class="nf">tencentyun</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span>
</code></pre></div></div> <h3 id="docker-挂载宿主机目录到容器中">Docker 挂载宿主机目录到容器中</h3> <ul> <li>参考文献：<a href="https://yeasy.gitbook.io/docker_practice/data_management/bind-mounts" rel="external nofollow noopener" target="_blank">挂载主机目录 - Docker — 从入门到实践 (gitbook.io)</a> </li> <li>指令：–mount type=bind,source=&lt;&gt;,target=&lt;&gt;</li> </ul> <h3 id="docker-挂载端口">Docker 挂载端口</h3> <div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dokcer run -itd -p 49159:80 -p 49160:22 ubuntu /bin/bash
</code></pre></div></div> <h3 id="新版-docker-增加-nvidia-container-toolkit">新版 Docker 增加 nvidia-container-toolkit</h3> <ul> <li>参考文献：</li> </ul> <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">distribution</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="o">.</span><span class="w"> </span><span class="n">/etc/os-release</span><span class="p">;</span><span class="n">echo</span><span class="w"> </span><span class="nv">$ID$VERSION_ID</span><span class="p">)</span><span class="w">
</span><span class="n">curl</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="nt">-L</span><span class="w"> </span><span class="nx">https://nvidia.github.io/nvidia-docker/gpgkey</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="nx">apt-key</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="o">-</span><span class="w">
</span><span class="n">curl</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="nt">-L</span><span class="w"> </span><span class="nx">https://nvidia.github.io/nvidia-docker/</span><span class="nv">$distribution</span><span class="nx">/nvidia-docker.list</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="nx">tee</span><span class="w"> </span><span class="nx">/etc/apt/sources.list.d/nvidia-docker.list</span><span class="w">

</span><span class="n">sudo</span><span class="w"> </span><span class="nx">apt-get</span><span class="w"> </span><span class="nx">update</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">sudo</span><span class="w"> </span><span class="nx">apt-get</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="nt">-y</span><span class="w"> </span><span class="nx">nvidia-container-toolkit</span><span class="w">
</span><span class="n">sudo</span><span class="w"> </span><span class="nx">systemctl</span><span class="w"> </span><span class="nx">restart</span><span class="w"> </span><span class="nx">docker</span><span class="w">
</span></code></pre></div></div> <h3 id="docker-compose-安装">docker-compose 安装</h3> <ul> <li>参考文献：<a href="https://github.com/docker/compose" rel="external nofollow noopener" target="_blank">docker/compose: Define and run multi-container applications with Docker (github.com)</a> </li> <li> <p>You can download Docker Compose binaries from the <u>release page</u> on this repository.</p> <ul> <li>Rename the relevant binary for your OS to <code class="language-plaintext highlighter-rouge">docker-compose</code> and copy it to <code class="language-plaintext highlighter-rouge">$HOME/.docker/cli-plugins</code> </li> <li>Or copy it into one of these folders to install it system-wide: <ul> <li> <code class="language-plaintext highlighter-rouge">/usr/local/lib/docker/cli-plugins</code> OR <code class="language-plaintext highlighter-rouge">/usr/local/libexec/docker/cli-plugins</code> </li> <li> <code class="language-plaintext highlighter-rouge">/usr/lib/docker/cli-plugins</code> OR <code class="language-plaintext highlighter-rouge">/usr/libexec/docker/cli-plugins</code> </li> </ul> </li> <li>(might require making the downloaded file executable with <code class="language-plaintext highlighter-rouge">chmod +x</code>)</li> </ul> </li> </ul> <h3 id="docker-compose-启动及后台启动指令">docker-compose 启动及后台启动指令</h3> <ul> <li>参考文献：<a href="https://github.com/wangduanduan/wangduanduan.github.io/issues/324" rel="external nofollow noopener" target="_blank">docker-compose up 服务如何后台运行 · Issue #324 · wangduanduan/wangduanduan.github.io</a> </li> </ul> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span>  <span class="o">#</span><span class="err">启动所有容器</span>
<span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>  <span class="o">#</span><span class="err">后台启动并运行所有容器</span>
<span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="c1">--no-recreate -d  #不重新创建已经停止的容器</span>
<span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span> <span class="n">test2</span>  <span class="o">#</span><span class="err">只启动</span><span class="n">test2</span><span class="err">这个容器</span>
<span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">stop</span>  <span class="o">#</span><span class="err">停止容器</span>
<span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="k">start</span>  <span class="o">#</span><span class="err">启动容器</span>
<span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">down</span> <span class="o">#</span><span class="err">停止并销毁容器</span>
</code></pre></div></div> <h2 id="k8s-相关的-linux-指令">K8S 相关的 Linux 指令</h2> <h3 id="安装和配置-microk8s">安装和配置 microk8s</h3> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sudo</span> <span class="n">snap</span> <span class="n">install</span> <span class="n">microk8s</span> <span class="c1">--classic --channel=1.22/stable</span>

<span class="n">sudo</span> <span class="n">usermod</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="k">G</span> <span class="n">microk8s</span> <span class="err">$</span><span class="k">USER</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="err">$</span><span class="n">HOME</span><span class="o">/</span><span class="p">.</span><span class="n">kube</span>
<span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">f</span> <span class="o">-</span><span class="n">R</span> <span class="o">&lt;</span><span class="n">your_user_name</span><span class="o">&gt;</span> <span class="o">~/</span><span class="p">.</span><span class="n">kube</span>
<span class="n">sudo</span> <span class="n">snap</span> <span class="k">alias</span> <span class="n">microk8s</span><span class="p">.</span><span class="n">kubectl</span> <span class="n">kubectl</span>
<span class="n">su</span> <span class="o">-</span> <span class="err">$</span><span class="k">USER</span>
<span class="n">microk8s</span> <span class="n">status</span> <span class="c1">--wait-ready</span>

<span class="p">(</span><span class="err">通常是</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">snap</span><span class="o">/</span><span class="n">microk8s</span><span class="o">/</span><span class="k">current</span><span class="o">/</span><span class="n">args</span><span class="o">/</span><span class="n">containerd</span><span class="o">-</span><span class="n">env</span><span class="p">)</span>
<span class="err">加入两行：</span>
<span class="n">HTTPS_PROXY</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">ip</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">7890</span>
<span class="n">HTTP_PROXY</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">ip</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">7890</span>
<span class="n">sudo</span> <span class="n">snap</span> <span class="k">restart</span> <span class="n">microk8s</span>
</code></pre></div></div> <ul> <li>安装完成后马上执行的指令 <ul> <li>允许 helm3</li> <li>更改 tiller 的镜像位置： <a href="https://blog.csdn.net/weixin_44666068/article/details/107609420" rel="external nofollow noopener" target="_blank">Helm 中 Tiller 镜像下载失败的解决办法_exec failed after 3 retires: pull image failed: fa-CSDN 博客</a> </li> </ul> </li> </ul> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">microk8s</span> <span class="nx">enable</span> <span class="nx">helm3</span>
<span class="nx">microk8s</span> <span class="nx">enable</span> <span class="nx">gpu</span>
<span class="nx">microk8s</span> <span class="nx">enable</span> <span class="nx">dns</span>

<span class="nx">kubectl</span> <span class="nx">config</span> <span class="nx">view</span> <span class="o">--</span><span class="nx">raw</span> <span class="o">&gt;</span> <span class="o">~</span><span class="sr">/.kube/</span><span class="nx">config</span>
</code></pre></div></div> <h3 id="microk8s-增加和删除节点">microk8s 增加和删除节点</h3> <ul> <li> <h2 id="参考文献microk8s-部署多节点-k8s-集群">参考文献：microk8s 部署多节点 k8s 集群</h2> </li> </ul> <h3 id="microk8s-升级">microk8s 升级</h3> <ul> <li>参考文献：<a href="https://microk8s.io/docs/upgrading" rel="external nofollow noopener" target="_blank">MicroK8s - 升级 MicroK8s</a> </li> </ul> <h3 id="进入容器的方法">进入容器的方法</h3> <div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl exec -it gpu-operator-6f97b7b47c-gfdt5 -n gpu-operator-resources -- /bin/bash
</code></pre></div></div> <h3 id="配置-microk8s-内置-docker-的-registrymirrors">配置 microk8s 内置 docker 的 registry.mirrors</h3> <ul> <li>参考文献：<a href="https://blog.csdn.net/u010674101/article/details/118019955" rel="external nofollow noopener" target="_blank">microk8s 安装过程中遇到的问题总结_少陽君的博客-CSDN 博客</a> </li> </ul> <p>编辑 /var/snap/microk8s/current/args/containerd-template.toml 文件</p> <p>在 endpoint 添加 新的 国内 registry.mirrors ， 如 “https://docker.mirrors.ustc.edu.cn”</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[plugins.cri.registry]
      [plugins.cri.registry.mirrors]
        [plugins.cri.registry.mirrors."docker.io"]
          endpoint = [
                "https://docker.mirrors.ustc.edu.cn",
                "https://hub-mirror.c.163.com",
                "https://mirror.ccs.tencentyun.com",
                "https://registry-1.docker.io"
          ]
</code></pre></div></div> <p>然后，先停止 microk8s，再启动 microk8s：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo microk8s stop
sudo microk8s start
</code></pre></div></div> <h3 id="完全卸载-microk8s">完全卸载 microk8s</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sudo</span> <span class="n">snap</span> <span class="n">remove</span> <span class="n">microk8s</span>
</code></pre></div></div> <h3 id="配置-microk8s-内置-docker-的-containerd-env-环境代理">配置 microk8s 内置 docker 的 containerd-env 环境代理</h3> <ul> <li>参考文献：<a href="https://blog.csdn.net/u010674101/article/details/118019955" rel="external nofollow noopener" target="_blank">microk8s 安装过程中遇到的问题总结_少陽君的博客-CSDN 博客</a> </li> </ul> <p>${SNAP_DATA}/args/containerd-env</p> <p>(通常是 /var/snap/microk8s/current/args/containerd-env)</p> <p>加入两行：</p> <p>HTTPS_PROXY=[http://<ip>/](http://<ip>:7890/)</ip></ip></p> <p>HTTP_PROXY=[http://<ip>/](http://<ip>:7890/)</ip></ip></p> <p>NO_PROXY=10.1.0.0/16,{K8SIP}/24</p> <p>{K8SIP}的获取方式是：kubectl get services -A ，查看所有的 cluster-ip</p> <p>然后重启 microk8s</p> <h3 id="配置变量使得环境不需要-sudo-和-microk8s-即可进入-kubectl">配置变量使得环境不需要 sudo 和 microk8s 即可进入 kubectl</h3> <ul> <li>失败方案</li> </ul> <p>If you prefer to omit <code class="language-plaintext highlighter-rouge">sudo</code>, add your user to the <code class="language-plaintext highlighter-rouge">microk8s</code> group, and then re-login to your shell:</p> <p>$ sudo usermod -a -G microk8s $USER</p> <p>If you prefer to use <code class="language-plaintext highlighter-rouge">kubectl</code> rather than <code class="language-plaintext highlighter-rouge">microk8s.kubectl</code>:</p> <p>$ mkdir -p $HOME/.kube</p> <p>$ sudo microk8s kubectl config view –raw &gt; $HOME/.kube/config</p> <p>$ sudo chown -f -R $USER ~/.kube</p> <ul> <li>成功方案：<a href="https://www.jianshu.com/p/3c2724f25c5e" rel="external nofollow noopener" target="_blank">使用 Microk8s 快速部署 kubernetes - 简书 (jianshu.com)</a> </li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sudo</span> <span class="n">usermod</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">G</span> <span class="n">microk8s</span> <span class="err">$</span><span class="n">USER</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="err">$</span><span class="n">HOME</span><span class="o">/</span><span class="p">.</span><span class="n">kube</span>
<span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">f</span> <span class="o">-</span><span class="n">R</span> <span class="o">&lt;</span><span class="n">your_user_name</span><span class="o">&gt;</span> <span class="o">~/</span><span class="p">.</span><span class="n">kube</span>
<span class="n">sudo</span> <span class="n">snap</span> <span class="n">alias</span> <span class="n">microk8s</span><span class="p">.</span><span class="n">kubectl</span> <span class="n">kubectl</span>
</code></pre></div></div> <h3 id="helm-的安装和代理">helm 的安装和代理</h3> <ul> <li>安装：</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sudo</span> <span class="n">snap</span> <span class="n">install</span> <span class="n">helm</span> <span class="o">--</span><span class="n">classic</span>
</code></pre></div></div> <ul> <li>代理：helm install with proxy-掘金 (juejin.cn) 【不太需要】</li> <li>配置验证</li> </ul> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 临时验证</span>
<span class="n">export</span> <span class="no">KUBECONFIG</span><span class="o">=</span><span class="sr">/var/sn</span><span class="n">ap</span><span class="o">/</span><span class="n">microk8s</span><span class="o">/</span><span class="n">current</span><span class="o">/</span><span class="n">credentials</span><span class="o">/</span><span class="n">client</span><span class="p">.</span><span class="nf">config</span>

<span class="c1"># 始终可以</span>
<span class="n">sudo</span> <span class="n">cp</span> <span class="sr">/var/sn</span><span class="n">ap</span><span class="o">/</span><span class="n">microk8s</span><span class="o">/</span><span class="n">current</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">ca</span><span class="p">.</span><span class="nf">crt</span> <span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">ca</span><span class="o">-</span><span class="n">certificates</span><span class="o">/</span><span class="n">microk8s</span><span class="p">.</span><span class="nf">crt</span>
<span class="n">sudo</span> <span class="n">update</span><span class="o">-</span><span class="n">ca</span><span class="o">-</span><span class="n">certificates</span>
<span class="n">sudo</span> <span class="n">snap</span> <span class="n">restart</span> <span class="n">microk8s</span>
</code></pre></div></div> <h3 id="helm-查看-chart-的版本不建议用这个方法去安装-dashboard">helm 查看 chart 的版本[不建议用这个方法去安装 dashboard]</h3> <div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#helm 列出所有版本:</span>
helm search repo kubernetes-dashboard/kubernetes-dashboard -l

helm install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard --version 3.0.2
</code></pre></div></div> <h3 id="helm-卸载某个应用">helm 卸载某个应用</h3> <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">helm</span> <span class="s">uninstall</span> <span class="s">kubernetes-dashboard</span> <span class="nc">kubernetes-dashboard/kubernetes-dashboard</span>
</code></pre></div></div> <h3 id="安装-dashboard">安装 dashboard</h3> <ul> <li>参考文献：<a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/" rel="external nofollow noopener" target="_blank">部署和访问 Kubernetes 仪表板（Dashboard） Kubernetes</a> <ul> <li>请直接从这里找指令下载，否则会比较麻烦</li> </ul> </li> </ul> <div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml
</code></pre></div></div> <h3 id="dashboard-如何登录">dashboard 如何登录</h3> <ul> <li>老版本的 dashboard 登陆方式</li> </ul> <div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 配置端口</span>
kubectl -n kubernetes-dashboard port-forward $POD_NAME 8443:8443
<span class="c"># kubectl -n kubernetes-dashboard port-forward kubernetes-dashboard-64c68cd4d5-k72nh 8443:8443  </span>

<span class="c"># 检查密钥</span>
kubectl -n kube-system get secret

<span class="c"># 获取密钥</span>
kubectl describe secret deployment-controller-token-???? -n kube-system
eyJhbGciOiJSUzI1NiIsImtpZCI6IlV0YkxXQ1hjTTc2ajNoUUZDUDhISVVidnZrNHFZMDBJSE91WGlXQ2wyMDAifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkZXBsb3ltZW50LWNvbnRyb2xsZXItdG9rZW4tZ3I5ZHYiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGVwbG95bWVudC1jb250cm9sbGVyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiNWNiMjBiNGQtOGVjNi00NDUwLWIxZDUtZDk1NDg0NzRiZWFjIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRlcGxveW1lbnQtY29udHJvbGxlciJ9.bM3XroK7vnE0UcfO717WiK1dGJNVXp4CA9hUtNhPwt_MtOnYDEPbBpOhPJKoRf8-nPXFS67dE8Uc3VdOxVfBdAO4JodWbjLShmbQtOcMxjHtmyYbsctKCK3MVxuLD2RYGtarO82u0gkhrK7CsadB2UXXeLRERmpTLSBPnpL9ikLKMYeiimn8lax5EcDVMwj4-P-xZtifz6LcKNCl6PHZI8D_kIn7m8tfBGvSBhVD1lApaqlQcP8lvDsehjXM_wiRCE8IV0ce9Rd5J6DHm6GuCJxw1LXN8VxgY1JCR75ZXqEAiSTxKk3eYholodEDdNzjM0yedEZn0qVotzAo1NozEw
<span class="c"># 复制到网页中</span>
</code></pre></div></div> <ul> <li>新版本登录方式</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div> <ul> <li>延长检测时间</li> </ul> <pre><code class="language-delphi">- name: kubernetes-dashboard
      image: 'kubernetesui/dashboard:v2.0.0-rc5'
      args:
        - '--auto-generate-certificates'
        - '--namespace=kubernetes-dashboard'
        - '--token-ttl=68400'     # 增加了此行
</code></pre> <h3 id="删除所有的-deploymentservicepodreplicasetsecretnamespace">删除所有的 deployment/service/pod/replicaset/secret/namespace</h3> <ul> <li>参考文献：<a href="https://www.cnblogs.com/ming-blogs/p/13986763.html" rel="external nofollow noopener" target="_blank">k8s 删除 pod 及 service - 明天,你好啊 - 博客园 (cnblogs.com)</a> </li> <li>第一/二/三步：[注意,前三部可以合并成一条指令]</li> </ul> <div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl delete -n adaptdl --all <span class="ss">all</span>
</code></pre></div></div> <ul> <li>第一步：检查某个命名空间下的所有内容 =&gt; kubectl get all -n adaptdl</li> </ul> <div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">NAME</span>                                         READY   STATUS    RESTARTS   AGE
pod/adaptdl-adaptdl-sched-59c9cfd956-gt7p5   3/3     Running   1          96m
pod/adaptdl-registry-7f45598964-dds2p        1/1     Running   0          96m
pod/adaptdl-validator-5cf868d86b-htnw6       1/1     Running   0          96m

<span class="nc">NAME</span>                            <span class="ss">TYPE</span>        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
service/adaptdl-adaptdl-sched   ClusterIP   10.152.183.45    &lt;none&gt;        9091/TCP         96m
service/adaptdl-registry        NodePort    10.152.183.126   &lt;none&gt;        5000:32000/TCP   96m
service/adaptdl-supervisor      ClusterIP   10.152.183.16    &lt;none&gt;        8080/TCP         96m
service/adaptdl-validator       ClusterIP   10.152.183.173   &lt;none&gt;        443/TCP          96m

<span class="nc">NAME</span>                                    READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/adaptdl-adaptdl-sched   1/1     1            1           96m
deployment.apps/adaptdl-registry        1/1     1            1           96m
deployment.apps/adaptdl-validator       1/1     1            1           96m

<span class="nc">NAME</span>                                               DESIRED   CURRENT   READY   AGE
replicaset.apps/adaptdl-adaptdl-sched-59c9cfd956   1         1         1       96m
replicaset.apps/adaptdl-registry-7f45598964        1         1         1       96m
replicaset.apps/adaptdl-validator-5cf868d86b       1         1         1       96m
</code></pre></div></div> <ul> <li>第二步：先 delete 所有的 deployment【会自动删除所有的 replicaset.apps 和 pod】</li> </ul> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kubectl</span> <span class="k">delete</span> <span class="n">deployment</span><span class="p">.</span><span class="n">apps</span><span class="o">/</span><span class="n">adaptdl</span><span class="o">-</span><span class="n">registry</span> <span class="o">-</span><span class="n">n</span> <span class="n">adaptdl</span>
</code></pre></div></div> <ul> <li>第三步：delete 所有的 service</li> <li>第四步[可选, 其实直接删除 namespace 也是可以直接删除这些的]：检索一下是否还有留存的 secrets：</li> </ul> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kubectl</span> <span class="k">get</span> <span class="n">secrets</span> <span class="o">-</span><span class="n">A</span>
<span class="n">kubectl</span> <span class="k">delete</span> <span class="n">secret</span> <span class="c1">--all -n adaptdl</span>
</code></pre></div></div> <ul> <li>第五步：删除最后的 namespace，完全干净的删除</li> </ul> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kubectl</span> <span class="k">delete</span> <span class="k">namespace</span> <span class="n">adaptdl</span>
</code></pre></div></div> <h3 id="namespace-无法删除的问题">namespace 无法删除的问题</h3> <ul> <li>k8s 命名空间 Terminating 产生原因及解决方法 - Martin 工作生活 Record (leiyawu.com)</li> </ul> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">TODELNS</span><span class="o">=</span><span class="n">kserve</span><span class="o">-</span><span class="nb">test</span>
<span class="n">kubectl</span> <span class="n">get</span> <span class="n">ns</span> <span class="err">$</span><span class="p">{</span><span class="no">TODELNS</span><span class="p">}</span> <span class="o">-</span><span class="n">o</span> <span class="n">json</span> <span class="o">&gt;</span> <span class="err">$</span><span class="p">{</span><span class="no">TODELNS</span><span class="p">}.</span><span class="nf">json</span>
<span class="n">code</span> <span class="err">$</span><span class="p">{</span><span class="no">TODELNS</span><span class="p">}.</span><span class="nf">json</span>
<span class="c1"># 将"spec": {        "finalizers": [            "kubernetes"        ]    },更改为："spec": {      },</span>

<span class="n">kubectl</span> <span class="n">proxy</span> <span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="mi">8081</span>

<span class="p">(</span><span class="n">新窗口</span><span class="p">)</span> <span class="n">lsof</span> <span class="o">-</span><span class="n">i</span><span class="p">:</span><span class="mi">8081</span>
<span class="p">(</span><span class="n">新窗口</span><span class="p">)</span> <span class="no">TODELNS</span><span class="o">=</span><span class="n">kserve</span><span class="o">-</span><span class="nb">test</span>
<span class="p">(</span><span class="n">新窗口</span><span class="p">)</span>  <span class="n">curl</span> <span class="o">-</span><span class="n">k</span> <span class="o">-</span><span class="no">H</span> <span class="s2">"Content-Type:application/json"</span> <span class="o">-</span><span class="no">X</span> <span class="no">PUT</span> <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">binary</span> <span class="err">@$</span><span class="p">{</span><span class="no">TODELNS</span><span class="p">}.</span><span class="nf">json</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8081</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">namespaces</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="no">TODELNS</span><span class="p">}</span><span class="o">/</span><span class="n">finalize</span>
</code></pre></div></div> <h3 id="配置-kserve-服务">配置 kserve 服务</h3> <ul> <li>参考文档：<a href="https://kserve.github.io/website/0.9/get_started/first_isvc/#4-determine-the-ingress-ip-and-ports" rel="external nofollow noopener" target="_blank">First InferenceService - KServe Documentation Website</a> </li> <li>配置踩坑：一定要在 microk8s 1.22 或者以上配置才能成功，老版本的 api 不兼容！</li> <li> <p>istio 的作用</p> <ul> <li>参考文献：<a href="https://jimmysong.io/blog/istio-servicemesh-api-gateway/" rel="external nofollow noopener" target="_blank">如何理解 Istio Ingress，它与 API Gateway 有什么区别？ · Jimmy Song</a> </li> <li>API 网关作为客户端访问后端的入口，已经存在很长时间了，它主要是用来管理”南北向“的流量；近几年服务网格开始流行，它主要是管理系统内部，即“东西向”流量，而像 Istio 这样的服务网格还内置了网关，从而将系统内外部的流量纳入了统一管控。</li> </ul> </li> </ul> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/feishu_docs_static/Ug9Fb2RZAoLAVlxiCRucAnFNnMe-480.webp 480w, /assets/img/feishu_docs_static/Ug9Fb2RZAoLAVlxiCRucAnFNnMe-800.webp 800w, /assets/img/feishu_docs_static/Ug9Fb2RZAoLAVlxiCRucAnFNnMe-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/feishu_docs_static/Ug9Fb2RZAoLAVlxiCRucAnFNnMe.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <ul> <li>其中阴影表示的是 Istio mesh，mesh 中的的流量属于集群内部（东西向）流量，而客户端访问 Kubernetes 集群内服务的流量属于外部（南北向）流量。</li> <li> <p>将 K8S 中的服务暴露对外的几种方式</p> <ul> <li>NodePort 、 LoadBalancer：K8S 内置的暴露服务的方式</li> <li>K8S Ingress： 用于支持虚拟主机、隐藏和节省 IP 地址。Ingress 就是从 Kubernetes 集群外访问集群的入口，将用户的 URL 请求转发到不同的服务上。Ingress 相当于 Nginx、Apache 等负载均衡方向代理服务器，其中还包括规则定义，即 URL 的路由信息，路由信息得的刷新由 Ingress controller 来提供。 <ul> <li>同一个服务的的不同示例可能被调度到不同的节点上；</li> <li>Kubernetes 通过 Service 对象将一个服务的多个实例组合在了一起，统一对外服务；</li> <li>Kubernetes 在每个 node 中安装了 kube-proxy 组件来转发流量，它拥有的简单的负载均衡功能；</li> <li>Kubernetes 集群外部流量可以通过 Ingress 进入集群中（Kubernetes 还有其他几种暴露服务的方式，如 NodePort、LoadBalancer 等）；</li> </ul> </li> </ul> </li> </ul> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/feishu_docs_static/Yl8mbMSJrocberxYAZkcDu00nCf-480.webp 480w, /assets/img/feishu_docs_static/Yl8mbMSJrocberxYAZkcDu00nCf-800.webp 800w, /assets/img/feishu_docs_static/Yl8mbMSJrocberxYAZkcDu00nCf-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/feishu_docs_static/Yl8mbMSJrocberxYAZkcDu00nCf.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/feishu_docs_static/MtuqbcbuJo1vdHxzxkccBr92nJf-480.webp 480w, /assets/img/feishu_docs_static/MtuqbcbuJo1vdHxzxkccBr92nJf-800.webp 800w, /assets/img/feishu_docs_static/MtuqbcbuJo1vdHxzxkccBr92nJf-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/feishu_docs_static/MtuqbcbuJo1vdHxzxkccBr92nJf.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <ul> <li>Istio Gateway：Istio 补足了 Kubernetes 对于云原生应用的流量管理、可观察性和安全方面的短板，使得流量管理变得对应用程序透明，使这部分功能从应用程序中转移到了平台层，成为了云原生基础设施。 <ul> <li>Istiod 作为控制平面，将配置下发给所有的 sidecar proxy 和 gateway（为了美观，图中没有画 Istiod 及 sidecar 之间的连接）</li> <li>Istio 不再使用 kube-proxy 组件做流量转发，而是依托在每个 pod 中注入的 sidecar proxy，所有的 proxy 组成了 Istio 的数据平面；</li> <li>应用程序管理员可以和管理 Kubernetes 中的工作负载一样，通过声明式 API 操作 Istio mesh 中流量的行为；</li> <li>Ingress 被 Gateway 资源所替代，Gateway 是一种特殊的 proxy，实际上也是复用的 Sidecar proxy；</li> <li>可以在虚拟机中安装 sidecar proxy，将虚拟机引入的 Istio mesh 中；</li> </ul> </li> </ul> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/feishu_docs_static/KsXabVNo5oEIohxuNgOc7kARnLO-480.webp 480w, /assets/img/feishu_docs_static/KsXabVNo5oEIohxuNgOc7kARnLO-800.webp 800w, /assets/img/feishu_docs_static/KsXabVNo5oEIohxuNgOc7kARnLO-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/feishu_docs_static/KsXabVNo5oEIohxuNgOc7kARnLO.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <ul> <li>API 网关：API 网关是位于客户端和后端服务之间的 API 管理工具，一种将客户端接口与后端实现分离的方式，在微服务中得到了广泛的应用。当客户端发出请求时，API 网关会将其分解为多个请求，然后将它们路由到正确的位置，生成响应，并跟踪所有内容。</li> </ul> <h3 id="配置-kserve-的一个-torch-服务">配置 kserve 的一个 torch 服务</h3> <ul> <li>使用网上已有的模型：<a href="https://kserve.github.io/website/0.8/modelserving/v1beta1/torchserve/" rel="external nofollow noopener" target="_blank">PyTorch - KServe Documentation Website</a> </li> </ul> <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">curl</span> <span class="s">-v</span> <span class="s">-H</span> <span class="s">"Host:</span> $<span class="p">{</span><span class="kn">SERVICE_HOSTNAME</span><span class="err">}</span><span class="s">"</span> <span class="s">-H</span> <span class="s">"Content-Type:</span> <span class="nc">application/json</span><span class="s">"</span> <span class="s">http://</span>$<span class="p">{</span><span class="kn">INGRESS_HOST</span><span class="err">}</span><span class="p">:</span>$<span class="p">{</span><span class="kn">INGRESS_PORT</span><span class="err">}</span><span class="n">/v1/models/</span>$<span class="p">{</span><span class="kn">MODEL_NAME</span><span class="err">}</span><span class="p">:</span><span class="s">predict</span> <span class="s">-d</span> <span class="s">@./input.json</span>
</code></pre></div></div> <ul> <li> <p>自己配置一个模型，上传到 kserve 中：</p> <ul> <li> <a href="https://kserve.github.io/website/0.9/modelserving/v1beta1/custom/custom_model/#arguments" rel="external nofollow noopener" target="_blank">方案 1（本地打包）：How to write a custom predictor - KServe Documentation Website</a> ;</li> <li>方案 2（github 下载）：<a href="https://kserve.github.io/website/0.9/modelserving/storage/uri/uri/#run-a-prediction_1" rel="external nofollow noopener" target="_blank">URI - KServe Documentation Website</a> </li> </ul> </li> <li>自己配置一个模型，上传到 kserve 中，并支持 serverless：</li> <li>Inference Graph =&gt; Serving mesh：一个推理服务需要好几个阶段，每个阶段的调度和分配！</li> </ul> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/feishu_docs_static/LR3UbPISPoBcZ4x3dcncCls3n9f-480.webp 480w, /assets/img/feishu_docs_static/LR3UbPISPoBcZ4x3dcncCls3n9f-800.webp 800w, /assets/img/feishu_docs_static/LR3UbPISPoBcZ4x3dcncCls3n9f-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/feishu_docs_static/LR3UbPISPoBcZ4x3dcncCls3n9f.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <ul> <li>batch 处理推理请求：<a href="https://kserve.github.io/website/0.9/modelserving/batcher/batcher/#example" rel="external nofollow noopener" target="_blank">Inference Batcher - KServe Documentation Website</a> </li> <li>Kserve 的调度器</li> </ul> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/feishu_docs_static/NSNQb3WgEoMGC6xWyZtcLFcQnG3-480.webp 480w, /assets/img/feishu_docs_static/NSNQb3WgEoMGC6xWyZtcLFcQnG3-800.webp 800w, /assets/img/feishu_docs_static/NSNQb3WgEoMGC6xWyZtcLFcQnG3-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/feishu_docs_static/NSNQb3WgEoMGC6xWyZtcLFcQnG3.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <ul> <li>GPU 支持</li> <li> <p>多模型服务【<a href="https://kserve.github.io/website/0.11/modelserving/mms/multi-model-serving/" rel="external nofollow noopener" target="_blank">The Scalability Problem - KServe Documentation Website</a>】</p> <ul> <li>随着机器学习方法在组织中越来越广泛采用，出现了部署大量模型的趋势。例如，新闻分类服务可以为每个新闻类别训练自定义模型。组织希望训练大量模型的另一个重要原因是保护数据隐私，因为隔离每个用户的数据并单独训练模型更安全。虽然通过为每个用例构建模型可以获得更好的推理准确性和数据隐私，但在 Kubernetes 集群上部署数千到数十万个模型更具挑战性。此外，服务基于神经网络的模型的用例越来越多。为了实现合理的延迟，这些模型最好在 GPU 上运行。然而，由于 GPU 是昂贵的资源，因此为许多基于 GPU 的模型提供服务的成本很高。</li> <li>KServe 的原始设计为每个 InferenceService 部署一个模型。但是，在处理大量模型时，其“一个模型、一个服务器”范式给 Kubernetes 集群带来了挑战。为了扩展模型的数量，我们必须扩展推理服务的数量，这可以快速挑战集群的限制。</li> <li>推理场景中的 GPU Sharing：由于将 sidecar 注入到每个 pod 中，每个 InferenceService 都会产生资源开销。这通常会为每个 InferenceService 副本增加约 0.5 个 CPU 和 0.5G 内存资源。例如，如果我们部署 10 个模型，每个模型有 2 个副本，则资源开销为 10 * 2 * 0.5 = 10 CPU 和 10 * 2 * 0.5 = 10 GB 内存。每个模型的资源开销为 1CPU 和 1 GB 内存。使用当前方法部署许多模型将很快耗尽集群的计算资源。通过多模型服务，这些模型可以加载到一个 InferenceService 中，那么每个模型的平均开销为 0.1 个 CPU 和 0.1GB 内存。对于基于 GPU 的模型，所需的 GPU 数量随着模型数量的增长而线性增长，这不符合成本效益。如果多个模型可以加载到一台启用 GPU 的模型服务器（例如 TritonServer）中，那么我们在集群中需要的 GPU 就会少很多。</li> </ul> </li> </ul> <div class="row mt-3"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/feishu_docs_static/BnvEbMbqEoIzJKxVi1bchakmnag-480.webp 480w, /assets/img/feishu_docs_static/BnvEbMbqEoIzJKxVi1bchakmnag-800.webp 800w, /assets/img/feishu_docs_static/BnvEbMbqEoIzJKxVi1bchakmnag-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/feishu_docs_static/BnvEbMbqEoIzJKxVi1bchakmnag.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <ul> <li>预处理 - 推理 - 后处理 的 Pipeline：是否可以从中找到优化点【<a href="https://kserve.github.io/website/0.11/modelserving/v1beta1/transformer/feast/" rel="external nofollow noopener" target="_blank">Feast - KServe Documentation Website</a>】</li> <li>问题：每次启动一个服务的时候似乎总在从网络上下载很大的镜像，尤其是 cuda 和 pytorch 的依赖镜像，是否会有合适的重用机制？</li> </ul> <h3 id="自定义-configmap-用于将本地">自定义 configmap 用于将本地</h3> <h3 id="自定义-deployment">自定义 Deployment</h3> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">gpu-pod-testvgpu</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span> <span class="c1"># 必须项</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">gpu-pod-testvgpu</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">gpu-pod-testvgpu</span> <span class="c1"># 设置与 selector 匹配的标签</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ubuntu-container</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">pytorch/pytorch:1.8.1-cuda10.2-cudnn7-runtime</span>
        <span class="na">volumeMounts</span><span class="pi">:</span> <span class="c1"># 挂载卷</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">script-volume</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/app/test-vgpu-resnet.py</span>
          <span class="na">subPath</span><span class="pi">:</span> <span class="s">test-vgpu-resnet.py</span>
        <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">python"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">/app/test-vgpu-resnet.py"</span><span class="pi">]</span> <span class="c1"># 执行指令</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">limits</span><span class="pi">:</span>
            <span class="na">nvidia.com/gpu</span><span class="pi">:</span> <span class="m">2</span> <span class="c1"># requesting 2 vGPUs</span>
            <span class="na">nvidia.com/gpumem</span><span class="pi">:</span> <span class="m">3000</span> <span class="c1"># Each vGPU contains 3000m device memory （Optional,Integer）</span>
            <span class="na">nvidia.com/gpucores</span><span class="pi">:</span> <span class="m">30</span> <span class="c1"># Each vGPU uses 30% of the entire GPU （Optional,Integer)</span>
      <span class="na">volumes</span><span class="pi">:</span> <span class="c1"># 从先创建的volume中使用</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">script-volume</span>
        <span class="na">configMap</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">test-vgpu-resnet</span>
</code></pre></div></div> <h3 id="自定义-job">自定义 Job</h3> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">batch/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Job</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">gpu-pod-testvgpu</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ubuntu-container</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">pytorch/pytorch:1.8.1-cuda10.2-cudnn7-runtime</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">script-volume</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/app/test-vgpu-resnet.py</span>
          <span class="na">subPath</span><span class="pi">:</span> <span class="s">test-vgpu-resnet.py</span>
        <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">python"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">/app/test-vgpu-resnet.py"</span><span class="pi">]</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">limits</span><span class="pi">:</span>
            <span class="na">nvidia.com/gpu</span><span class="pi">:</span> <span class="m">2</span> <span class="c1"># requesting 2 vGPUs</span>
            <span class="na">nvidia.com/gpumem</span><span class="pi">:</span> <span class="m">3000</span> <span class="c1"># Each vGPU contains 3000m device memory （Optional,Integer）</span>
            <span class="na">nvidia.com/gpucores</span><span class="pi">:</span> <span class="m">30</span> <span class="c1"># Each vGPU uses 30% of the entire GPU （Optional,Integer)</span>
      <span class="na">restartPolicy</span><span class="pi">:</span> <span class="s">Never</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">script-volume</span>
        <span class="na">configMap</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">test-vgpu-resnet</span>
</code></pre></div></div> <h3 id="优雅退出">优雅退出</h3> <ul> <li>参考文献：<a href="https://aleiwu.com/post/tidb-opeartor-webhook/" rel="external nofollow noopener" target="_blank">Kubernetes 中如何保证优雅地停止 Pod (aleiwu.com)</a> </li> </ul> </div> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Linchang Xiao. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?9b43d6e67ddc7c0855b1478ee4c48c2d" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>